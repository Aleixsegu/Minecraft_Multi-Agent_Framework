============================= test session starts =============================
platform win32 -- Python 3.12.10, pytest-9.0.2, pluggy-1.6.0 -- C:\Users\Usuario\Desktop\PC\UNI\TERCERO\TAP\PRACTICA\Minecraft_Multi-Agent_Framework\venv\Scripts\python.exe
cachedir: .pytest_cache
rootdir: C:\Users\Usuario\Desktop\PC\UNI\TERCERO\TAP\PRACTICA\Minecraft_Multi-Agent_Framework
configfile: pytest.ini
plugins: asyncio-1.3.0, cov-7.0.0
asyncio: mode=Mode.AUTO, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 99 items

Multi-Agent_System/tests/test_agent_factory.py::test_singleton_behavior PASSED [  1%]
Multi-Agent_System/tests/test_agent_factory.py::test_register_valid_agent PASSED [  2%]
Multi-Agent_System/tests/test_agent_factory.py::test_register_invalid_agent_raises_error PASSED [  3%]
Multi-Agent_System/tests/test_agent_factory.py::test_create_agent PASSED [  4%]
Multi-Agent_System/tests/test_agent_factory.py::test_create_unregistered_agent_raises_error PASSED [  5%]
Multi-Agent_System/tests/test_agent_manager.py::test_initialization PASSED [  6%]
Multi-Agent_System/tests/test_agent_manager.py::test_setup_subscriptions PASSED [  7%]
Multi-Agent_System/tests/test_agent_manager.py::test_create_agent_success PASSED [  8%]
Multi-Agent_System/tests/test_agent_manager.py::test_create_agent_already_exists PASSED [  9%]
Multi-Agent_System/tests/test_agent_manager.py::test_create_agent_failure PASSED [ 10%]
Multi-Agent_System/tests/test_agent_manager.py::test_handle_create_command PASSED [ 11%]
Multi-Agent_System/tests/test_agent_manager.py::test_handle_message_create PASSED [ 12%]
Multi-Agent_System/tests/test_agent_manager.py::test_handle_message_workflow PASSED [ 13%]
Multi-Agent_System/tests/test_agent_manager.py::test_run_loop PASSED     [ 14%]
Multi-Agent_System/tests/test_base_agent.py::test_initial_state PASSED   [ 15%]
Multi-Agent_System/tests/test_base_agent.py::test_state_transition PASSED [ 16%]
Multi-Agent_System/tests/test_base_agent.py::test_handle_command_pause PASSED [ 17%]
Multi-Agent_System/tests/test_base_agent.py::test_handle_command_stop PASSED [ 18%]
Multi-Agent_System/tests/test_base_agent.py::test_handle_command_update PASSED [ 19%]
Multi-Agent_System/tests/test_base_agent.py::test_run_cycle_execution PASSED [ 20%]
Multi-Agent_System/tests/test_base_agent.py::test_handle_incoming_message_filtering FAILED [ 21%]
Multi-Agent_System/tests/test_base_agent.py::test_set_state_side_effects PASSED [ 22%]
Multi-Agent_System/tests/test_base_agent.py::test_handle_command_status_help PASSED [ 23%]
Multi-Agent_System/tests/test_block_translator.py::TestBlockTranslator::test_get_block_id_simple PASSED [ 24%]
Multi-Agent_System/tests/test_block_translator.py::TestBlockTranslator::test_get_block_id_with_namespace PASSED [ 25%]
Multi-Agent_System/tests/test_block_translator.py::TestBlockTranslator::test_get_block_id_with_properties PASSED [ 26%]
Multi-Agent_System/tests/test_block_translator.py::TestBlockTranslator::test_get_block_id_fallbacks PASSED [ 27%]
Multi-Agent_System/tests/test_block_translator.py::TestBlockTranslator::test_get_block_id_unknown_default PASSED [ 28%]
Multi-Agent_System/tests/test_block_translator.py::TestBlockTranslator::test_get_block_name_found PASSED [ 29%]
Multi-Agent_System/tests/test_block_translator.py::TestBlockTranslator::test_get_block_name_not_found PASSED [ 30%]
Multi-Agent_System/tests/test_builder_bot.py::test_initialization PASSED [ 31%]
Multi-Agent_System/tests/test_builder_bot.py::test_handle_command_plan_list PASSED [ 32%]
Multi-Agent_System/tests/test_builder_bot.py::test_handle_command_plan_set_success PASSED [ 33%]
Multi-Agent_System/tests/test_builder_bot.py::test_handle_command_build PASSED [ 34%]
Multi-Agent_System/tests/test_builder_bot.py::test_perceive_map PASSED   [ 35%]
Multi-Agent_System/tests/test_builder_bot.py::test_decide_analyzing_map PASSED [ 36%]
Multi-Agent_System/tests/test_builder_bot.py::test_decide_waiting_materials PASSED [ 37%]
Multi-Agent_System/tests/test_builder_bot.py::test_act_start_building PASSED [ 38%]
Multi-Agent_System/tests/test_builder_bot.py::test_build_structure_task_logic PASSED [ 39%]
Multi-Agent_System/tests/test_chat_listener.py::test_initialization PASSED [ 40%]
Multi-Agent_System/tests/test_chat_listener.py::test_stop PASSED         [ 41%]
Multi-Agent_System/tests/test_chat_listener.py::test_listen_processing_messages PASSED [ 42%]
Multi-Agent_System/tests/test_checkpoints.py::TestCheckpoints::test_init_creates_dir PASSED [ 43%]
Multi-Agent_System/tests/test_checkpoints.py::TestCheckpoints::test_make_serializable PASSED [ 44%]
Multi-Agent_System/tests/test_checkpoints.py::TestCheckpoints::test_save_and_load PASSED [ 45%]
Multi-Agent_System/tests/test_checkpoints.py::TestCheckpoints::test_load_non_existent PASSED [ 46%]
Multi-Agent_System/tests/test_checkpoints.py::TestCheckpoints::test_load_corrupt_json PASSED [ 47%]
Multi-Agent_System/tests/test_checkpoints.py::TestCheckpoints::test_clear_prev_checkpoints PASSED [ 48%]
Multi-Agent_System/tests/test_checkpoints.py::TestCheckpoints::test_save_error_handling PASSED [ 49%]
Multi-Agent_System/tests/test_explorer_bot.py::TestExplorerBot::test_decompose_to_rectangles PASSED [ 50%]
Multi-Agent_System/tests/test_explorer_bot.py::TestExplorerBot::test_handle_command_start PASSED [ 51%]
Multi-Agent_System/tests/test_explorer_bot.py::TestExplorerBot::test_handle_command_set PASSED [ 52%]
Multi-Agent_System/tests/test_explorer_bot.py::TestExplorerBot::test_decide_logic PASSED [ 53%]
Multi-Agent_System/tests/test_explorer_bot.py::TestExplorerBot::test_act_execution PASSED [ 54%]
Multi-Agent_System/tests/test_explorer_bot.py::TestExplorerBot::test_scan_and_find_zones_mocked PASSED [ 55%]
Multi-Agent_System/tests/test_explorer_bot.py::TestExplorerBot::test_scan_pausing PASSED [ 56%]
Multi-Agent_System/tests/test_explorer_bot.py::TestExplorerBot::test_resume_command PASSED [ 57%]
Multi-Agent_System/tests/test_integration_workflow.py::TestIntegrationWorkflow::test_workflow_execution_flow PASSED [ 58%]
Multi-Agent_System/tests/test_json_schema.py::test_validate_valid_message PASSED [ 59%]
Multi-Agent_System/tests/test_json_schema.py::test_validate_missing_fields PASSED [ 60%]
Multi-Agent_System/tests/test_json_schema.py::test_validate_invalid_types PASSED [ 61%]
Multi-Agent_System/tests/test_json_schema.py::test_validate_invalid_timestamp PASSED [ 62%]
Multi-Agent_System/tests/test_json_schema.py::test_validate_invalid_status PASSED [ 63%]
Multi-Agent_System/tests/test_message_bus.py::test_register_agent PASSED [ 64%]
Multi-Agent_System/tests/test_message_bus.py::test_subscribe_agent PASSED [ 65%]
Multi-Agent_System/tests/test_message_bus.py::test_subscribe_unregistered_agent_raises_error PASSED [ 66%]
Multi-Agent_System/tests/test_message_bus.py::test_publish_subscribe_delivery PASSED [ 67%]
Multi-Agent_System/tests/test_message_bus.py::test_publish_direct_delivery PASSED [ 68%]
Multi-Agent_System/tests/test_message_bus.py::test_receive_unregistered_raises_error PASSED [ 69%]
Multi-Agent_System/tests/test_message_parser.py::test_parse_valid_command_with_params PASSED [ 70%]
Multi-Agent_System/tests/test_message_parser.py::test_parse_command_with_string_and_int_params PASSED [ 71%]
Multi-Agent_System/tests/test_message_parser.py::test_parse_invalid_command_formatting PASSED [ 72%]
Multi-Agent_System/tests/test_message_parser.py::test_parse_unknown_agent PASSED [ 73%]
Multi-Agent_System/tests/test_miner_bot.py::TestMinerBot::test_process_bom_resets_inventory FAILED [ 74%]
Multi-Agent_System/tests/test_miner_bot.py::TestMinerBot::test_decide_priorities FAILED [ 75%]
Multi-Agent_System/tests/test_miner_bot.py::TestMinerBot::test_act_mine_physical PASSED [ 76%]
Multi-Agent_System/tests/test_miner_bot.py::TestMinerBot::test_act_initial_mine PASSED [ 77%]
Multi-Agent_System/tests/test_miner_bot.py::TestMinerBot::test_handle_command_start_manual FAILED [ 78%]
Multi-Agent_System/tests/test_miner_bot.py::TestMinerBot::test_handle_command_set_strategy PASSED [ 79%]
Multi-Agent_System/tests/test_miner_bot.py::TestMinerBot::test_load_strategy_dynamically PASSED [ 80%]
Multi-Agent_System/tests/test_schematic_parser.py::TestSimpleNBT::test_read_byte PASSED [ 81%]
Multi-Agent_System/tests/test_schematic_parser.py::TestSimpleNBT::test_read_short PASSED [ 82%]
Multi-Agent_System/tests/test_schematic_parser.py::TestSimpleNBT::test_read_int PASSED [ 83%]
Multi-Agent_System/tests/test_schematic_parser.py::TestSimpleNBT::test_read_long PASSED [ 84%]
Multi-Agent_System/tests/test_schematic_parser.py::TestSimpleNBT::test_read_float_double PASSED [ 85%]
Multi-Agent_System/tests/test_schematic_parser.py::TestSimpleNBT::test_read_string PASSED [ 86%]
Multi-Agent_System/tests/test_schematic_parser.py::TestSimpleNBT::test_read_int_array PASSED [ 87%]
Multi-Agent_System/tests/test_schematic_parser.py::TestSimpleNBT::test_read_long_array PASSED [ 88%]
Multi-Agent_System/tests/test_schematic_parser.py::TestSimpleNBT::test_read_list PASSED [ 89%]
Multi-Agent_System/tests/test_schematic_parser.py::TestSchematicParser::test_load_error PASSED [ 90%]
Multi-Agent_System/tests/test_schematic_parser.py::TestSchematicParser::test_decode_block_data PASSED [ 91%]
Multi-Agent_System/tests/test_schematic_parser.py::TestSchematicParser::test_get_blocks_and_bom PASSED [ 92%]
Multi-Agent_System/tests/test_schematic_parser.py::TestSchematicParser::test_get_blocks_nested_format PASSED [ 93%]
Multi-Agent_System/tests/test_strategies.py::TestStrategies::test_grid_next_position FAILED [ 94%]
Multi-Agent_System/tests/test_strategies.py::TestStrategies::test_vertical_strategy FAILED [ 95%]
Multi-Agent_System/tests/test_strategies.py::TestStrategies::test_vein_strategy FAILED [ 96%]
Multi-Agent_System/tests/test_synchronization.py::TestSynchronization::test_ensure_agent_waits_for_idle PASSED [ 97%]
Multi-Agent_System/tests/test_unit_core.py::TestUnitCore::test_message_parser_init PASSED [ 98%]
Multi-Agent_System/tests/test_unit_core.py::TestUnitCore::test_message_bus_pub_sub PASSED [100%]

================================== FAILURES ===================================
___________________ test_handle_incoming_message_filtering ____________________

agent = <tests.test_base_agent.ConcreteAgent object at 0x0000016A528F62A0>

    @pytest.mark.asyncio
    async def test_handle_incoming_message_filtering(agent):
        # Test valid message for this agent
        msg = {"type": "command.pause.v1", "payload": {"id": agent.id}}
>       agent.handle_command = AsyncMock()
                               ^^^^^^^^^
E       NameError: name 'AsyncMock' is not defined

Multi-Agent_System\tests\test_base_agent.py:78: NameError
_______________ TestMinerBot.test_process_bom_resets_inventory ________________

self = <tests.test_miner_bot.TestMinerBot object at 0x0000016A527CB080>
bot = <agents.miner_bot.MinerBot object at 0x0000016A52953B00>

    def test_process_bom_resets_inventory(self, bot):
        payload = {
            "requirements": {"stone": 10, "diamond": 1},
            "build_position": (10, 64, 10)
        }
        with patch('agents.miner_bot.get_block_id', return_value=1):
>            bot._process_bom(payload)

Multi-Agent_System\tests\test_miner_bot.py:25: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
Multi-Agent_System\src\agents\miner_bot.py:173: in _process_bom
    asyncio.create_task(self.set_state(State.RUNNING, "BOM Processed"))
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

coro = <coroutine object BaseAgent.set_state at 0x0000016A526D8310>

    def create_task(coro, *, name=None, context=None):
        """Schedule the execution of a coroutine object in a spawn task.
    
        Return a Task object.
        """
>       loop = events.get_running_loop()
               ^^^^^^^^^^^^^^^^^^^^^^^^^
E       RuntimeError: no running event loop

C:\Program Files\WindowsApps\PythonSoftwareFoundation.Python.3.12_3.12.2800.0_x64__qbz5n2kfra8p0\Lib\asyncio\tasks.py:417: RuntimeError
_____________________ TestMinerBot.test_decide_priorities _____________________

self = <tests.test_miner_bot.TestMinerBot object at 0x0000016A527CA240>
bot = <agents.miner_bot.MinerBot object at 0x0000016A52932D80>

    @pytest.mark.asyncio
    async def test_decide_priorities(self, bot):
        bot.state = State.RUNNING
        bot.context['mining_active'] = True
    
        # Case 1: Not arrived at mine
        bot.context['arrived_at_mine'] = False
        bot.context['target_x'] = 100
        await bot.decide()
>       assert bot.context['next_action'] == 'initial_mine'
E       AssertionError: assert 'finish_delivery' == 'initial_mine'
E         
E         - initial_mine
E         + finish_delivery

Multi-Agent_System\tests\test_miner_bot.py:41: AssertionError
________________ TestMinerBot.test_handle_command_start_manual ________________

self = <tests.test_miner_bot.TestMinerBot object at 0x0000016A527CAE70>
bot = <agents.miner_bot.MinerBot object at 0x0000016A528B5B50>

    @pytest.mark.asyncio
    async def test_handle_command_start_manual(self, bot):
        await bot.handle_command("start", {"x": 50, "z": 50})
        assert bot.context['target_x'] == 50
        assert bot.context['target_z'] == 50
>       assert bot.state == State.RUNNING
E       AssertionError: assert <State.IDLE: 'IDLE'> == <State.RUNNING: 'RUNNING'>
E        +  where <State.IDLE: 'IDLE'> = <agents.miner_bot.MinerBot object at 0x0000016A528B5B50>.state
E        +  and   <State.RUNNING: 'RUNNING'> = State.RUNNING

Multi-Agent_System\tests\test_miner_bot.py:101: AssertionError
___________________ TestStrategies.test_grid_next_position ____________________

self = <tests.test_strategies.TestStrategies object at 0x0000016A527D9B80>
mock_agent = <MagicMock id='1556164322192'>

    def test_grid_next_position(self, mock_agent):
>       st = GridStrategy(mock_agent)
             ^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: GridStrategy.__init__() missing 2 required positional arguments: 'logger' and 'agent_id'

Multi-Agent_System\tests\test_strategies.py:21: TypeError
____________________ TestStrategies.test_vertical_strategy ____________________

self = <tests.test_strategies.TestStrategies object at 0x0000016A527D9E80>
mock_agent = <MagicMock id='1556164307440'>

    def test_vertical_strategy(self, mock_agent):
>       st = VerticalStrategy(mock_agent)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: VerticalStrategy.__init__() missing 2 required positional arguments: 'logger' and 'agent_id'

Multi-Agent_System\tests\test_strategies.py:36: TypeError
______________________ TestStrategies.test_vein_strategy ______________________

self = <tests.test_strategies.TestStrategies object at 0x0000016A527DA180>
mock_agent = <MagicMock id='1556162862624'>

    def test_vein_strategy(self, mock_agent):
>       st = VeinStrategy(mock_agent)
             ^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: VeinStrategy.__init__() missing 2 required positional arguments: 'logger' and 'agent_id'

Multi-Agent_System\tests\test_strategies.py:45: TypeError
=============================== tests coverage ================================
______________ coverage: platform win32, python 3.12.10-final-0 _______________

Name                                                     Stmts   Miss  Cover   Missing
--------------------------------------------------------------------------------------
Multi-Agent_System\src\agents\agent_factory.py              22      0   100%
Multi-Agent_System\src\agents\agent_manager.py              61      6    90%   40-42, 57, 87-88
Multi-Agent_System\src\agents\base_agent.py                103     20    81%   31, 35, 39, 60, 65, 69-75, 90-91, 94-95, 103-105, 128-130
Multi-Agent_System\src\agents\builder_bot.py               302    128    58%   38-41, 44-45, 49-58, 73-74, 94-105, 113, 124-125, 129-131, 143-147, 157, 170-172, 200-207, 217-239, 248-249, 266-269, 273-276, 315-319, 328-340, 343-357, 360-371, 394-395, 415-418, 423-440, 457-469
Multi-Agent_System\src\agents\explorer_bot.py              374    118    68%   22-30, 40-41, 60, 64-69, 81-82, 89-90, 209-253, 258, 277-279, 332-334, 338-341, 350-354, 382, 421, 424-426, 439-440, 445-448, 452, 454-456, 461-465, 471-485, 489-490, 504-505, 525-535, 563-577
Multi-Agent_System\src\agents\miner_bot.py                 323    185    43%   61-67, 70-71, 74-111, 137, 150, 176-183, 187-188, 194-220, 228-233, 239, 242-249, 260, 277-290, 295-298, 301-304, 320-325, 328, 334-383, 386-393, 396-403, 406-412, 420-425, 428-430, 440-443, 452-459, 475-479
Multi-Agent_System\src\agents\state_model.py                 8      0   100%
Multi-Agent_System\src\agents\workflow_manager.py           67      4    94%   65, 69-71
Multi-Agent_System\src\messages\chat_listener.py            25      3    88%   42-44
Multi-Agent_System\src\messages\message_bus.py              58      6    90%   61-63, 88, 100, 109
Multi-Agent_System\src\messages\message_parser.py          122     54    56%   69-71, 75-76, 80-81, 106, 123-152, 156-178, 192-200
Multi-Agent_System\src\strategies\grid_strategy.py          40     24    40%   27-61
Multi-Agent_System\src\strategies\mining_strategy.py        12      1    92%   30
Multi-Agent_System\src\strategies\vein_strategy.py          71     62    13%   15-19, 25-116
Multi-Agent_System\src\strategies\vertical_strategy.py      39     30    23%   15-18, 24-69
Multi-Agent_System\src\utils\block_translator.py            38      0   100%
Multi-Agent_System\src\utils\checkpoints.py                 53      2    96%   48, 84
Multi-Agent_System\src\utils\json_schema.py                 34      6    82%   30, 40, 44, 48, 62, 70
Multi-Agent_System\src\utils\logging.py                     52      9    83%   16-23, 50
Multi-Agent_System\src\utils\reflection.py                  64     10    84%   21-22, 41-42, 56-57, 76-77, 102-103
Multi-Agent_System\src\utils\schematic_parser.py           170      6    96%   25, 39, 41, 43, 48, 70
--------------------------------------------------------------------------------------
TOTAL                                                     2038    674    67%
Coverage XML written to file coverage.xml
=========================== short test summary info ===========================
FAILED Multi-Agent_System/tests/test_base_agent.py::test_handle_incoming_message_filtering
FAILED Multi-Agent_System/tests/test_miner_bot.py::TestMinerBot::test_process_bom_resets_inventory
FAILED Multi-Agent_System/tests/test_miner_bot.py::TestMinerBot::test_decide_priorities
FAILED Multi-Agent_System/tests/test_miner_bot.py::TestMinerBot::test_handle_command_start_manual
FAILED Multi-Agent_System/tests/test_strategies.py::TestStrategies::test_grid_next_position
FAILED Multi-Agent_System/tests/test_strategies.py::TestStrategies::test_vertical_strategy
FAILED Multi-Agent_System/tests/test_strategies.py::TestStrategies::test_vein_strategy
======================== 7 failed, 92 passed in 8.09s =========================
